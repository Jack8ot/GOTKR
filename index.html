<!DOCTYPE html>
<html>
<head>
  <title>位置記錄測試</title>
</head>
<body>
  <h2>正在記錄你的位置...</h2>
  <div id="log"></div>

  <script>
    if (navigator.geolocation) {
      let count = 0;
      const maxSamples = 10;
      const logDiv = document.getElementById('log');
      const webhookURL = 'https://script.google.com/macros/s/AKfycbzrovhMlps0-GWIyEq3rrF68HdiIzclV0NXQP3izCkBv67MLuAFbJpwMqqEUFlea4Uo/exec'; // ⚠️ 請換成你自己的 Web App URL

      const sendLocation = (lat, lon) => {
        fetch(webhookURL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            latitude: lat,
            longitude: lon
          })
        }).then(() => {
          logDiv.innerHTML += `<p>已傳送 (${lat}, ${lon})</p>`;
        }).catch((err) => {
          logDiv.innerHTML += `<p style="color:red;">傳送失敗：${err.message}</p>`;
        });
      };

      const watchId = navigator.geolocation.watchPosition(
        (pos) => {
          const lat = pos.coords.latitude.toFixed(7);
          const lon = pos.coords.longitude.toFixed(7);
          sendLocation(lat, lon);
          count++;
          if (count >= maxSamples) {
            navigator.geolocation.clearWatch(watchId);
            logDiv.innerHTML += `<p>✅ 記錄完成</p>`;
          }
        },
        (err) => {
          logDiv.innerHTML = `<p style="color:red;">無法取得位置：${err.message}</p>`;
        },
        { enableHighAccuracy: true, maximumAge: 0, timeout: 10000 }
      );
    } else {
      document.getElementById('log').innerHTML = "你的瀏覽器不支援定位功能";
    }
  </script>
</body>
</html>
