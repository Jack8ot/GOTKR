<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>位置紀錄測試</title>
</head>
<body>
  <h2>自動記錄位置資訊中...</h2>
  <div id="status"></div>

  <script>
    const webhookURL = "https://script.google.com/macros/s/AKfycbzY9ZQLDjCXN1u9CiK0D2iW20xmoIIPLqxqrJQlB8RUXSEyPEvyhPNmIwC9i4jIqSbs/exec"; // ⬅️ 請貼上你自己的 Web App URL
    const statusDiv = document.getElementById("status");

    if (navigator.geolocation) {
      let count = 0;
      const maxCount = 10;

      const sendLocation = (lat, lon) => {
        fetch(webhookURL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            latitude: lat,
            longitude: lon
          })
        }).then(() => {
          statusDiv.innerHTML += `<p>✔️ 已送出 (${lat}, ${lon})</p>`;
        }).catch((err) => {
          statusDiv.innerHTML += `<p style="color:red;">❌ 發送失敗：${err.message}</p>`;
        });
      };

      const watchId = navigator.geolocation.watchPosition(
        (pos) => {
          const lat = pos.coords.latitude.toFixed(7);
          const lon = pos.coords.longitude.toFixed(7);
          sendLocation(lat, lon);
          count++;
          if (count >= maxCount) {
            navigator.geolocation.clearWatch(watchId);
            statusDiv.innerHTML += `<p>✅ 記錄完成</p>`;
          }
        },
        (err) => {
          statusDiv.innerHTML = `<p style="color:red;">⚠️ 位置取得失敗：${err.message}</p>`;
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        }
      );
    } else {
      statusDiv.innerHTML = "你的瀏覽器不支援定位功能。";
    }
  </script>
</body>
</html>
